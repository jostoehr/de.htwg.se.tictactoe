<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="de"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>TextUI.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JaCoCoverage analysis of project &quot;htwg.se.tictactoe&quot; (powered by JaCoCo from EclEmma)</a> &gt; <a href="index.source.html" class="el_package">de.htwg.tictactoe.tui</a> &gt; <span class="el_source">TextUI.java</span></div><h1>TextUI.java</h1><pre class="source lang-java linenums">package de.htwg.tictactoe.tui;

import de.htwg.tictactoe.controller.TictactoeController;
import de.htwg.tictactoe.controller.impl.StateCrossPlaying;
import de.htwg.tictactoe.controller.impl.StateCrossWon;
import de.htwg.tictactoe.controller.impl.StateDraw;
import de.htwg.tictactoe.controller.impl.StateNoughtPlaying;
import de.htwg.tictactoe.controller.impl.StateNoughtWon;
import de.htwg.tictactoe.entities.Enum;
import de.htwg.util.observer.IObserver;
import java.util.Scanner;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

/**
 *
 * @author johannes
 */
public class TextUI implements IObserver {

    private TictactoeController controller;
    private Scanner scanner;
    private String mode;
    
    /**
     * String literal for printStatus
     */
<span class="nc" id="L28">    private String turn = &quot; it's your turn!&quot;;</span>
    
    /**
     * String literal is
     */
<span class="nc" id="L33">    private String is = &quot; is &quot;;</span>
    
<span class="nc" id="L35">    public TextUI(TictactoeController controller) {</span>
<span class="nc" id="L36">        this.controller = controller;</span>
<span class="nc" id="L37">        scanner = new Scanner(System.in);</span>
<span class="nc" id="L38">        modeChange();</span>
<span class="nc" id="L39">        player();        </span>
<span class="nc" id="L40">    }</span>
    
    @Override
    public void update() {
<span class="nc" id="L44">        printTUI();</span>
<span class="nc" id="L45">    }</span>

    public void printTUI() {
<span class="nc" id="L48">        printStatus();</span>
<span class="nc" id="L49">        System.out.print(controller.getGridString());</span>
<span class="nc" id="L50">	System.out.print(controller.getStatus());</span>
<span class="nc" id="L51">        printHelp();</span>
<span class="nc" id="L52">    }</span>
    
    public boolean processInputLine(String line){
<span class="nc" id="L55">        boolean continu = true;</span>
<span class="nc bnc" id="L56" title="All 2 branches missed.">        if (line.equalsIgnoreCase(&quot;h&quot;)) {</span>
<span class="nc" id="L57">            printHelp();</span>
        } 
<span class="nc bnc" id="L59" title="All 2 branches missed.">        if (line.equalsIgnoreCase(&quot;n&quot;)) {</span>
<span class="nc" id="L60">            controller.init();</span>
<span class="nc" id="L61">            System.out.println(&quot;New Game is created&quot;);</span>
<span class="nc" id="L62">            controller.setCurrentState(new StateCrossPlaying(controller));</span>
        }
        
<span class="nc bnc" id="L65" title="All 2 branches missed.">        if (line.equalsIgnoreCase(&quot;m&quot;)) {</span>
<span class="nc" id="L66">            modeChange();</span>
<span class="nc" id="L67">            player();</span>
<span class="nc" id="L68">            controller.init();</span>
<span class="nc" id="L69">            controller.setCurrentState(new StateCrossPlaying(controller));</span>
        }
        
<span class="nc bnc" id="L72" title="All 2 branches missed.">        if (line.equalsIgnoreCase(&quot;c&quot;)) {</span>
<span class="nc bnc" id="L73" title="All 2 branches missed.">            if(controller.getCurrentState() instanceof StateCrossWon</span>
<span class="nc bnc" id="L74" title="All 2 branches missed.">                    || controller.getCurrentState() instanceof StateNoughtWon</span>
<span class="nc bnc" id="L75" title="All 2 branches missed.">                    || controller.getCurrentState() instanceof StateDraw </span>
<span class="nc bnc" id="L76" title="All 2 branches missed.">                    || controller.isEmpty()) {</span>
<span class="nc bnc" id="L77" title="All 2 branches missed.">                if(controller.getPlayer1().getCharacter().equals(Enum.CROSS)) {</span>
<span class="nc" id="L78">                    controller.getPlayer1().setCharacter(Enum.NOUGHT);</span>
<span class="nc" id="L79">                    controller.getPlayer2().setCharacter(Enum.CROSS);</span>
                } else {
<span class="nc" id="L81">                    controller.getPlayer1().setCharacter(Enum.CROSS);</span>
<span class="nc" id="L82">                    controller.getPlayer2().setCharacter(Enum.NOUGHT);                </span>
                }
<span class="nc" id="L84">                System.out.println(&quot;Changed Characters x and o&quot;);</span>
<span class="nc" id="L85">                System.out.println(controller.getPlayer1().getName() + is + controller.getPlayer1().getCharacter()</span>
<span class="nc" id="L86">                + &quot;, &quot; + controller.getPlayer2().getName() + is + controller.getPlayer2().getCharacter());</span>
            } else {
<span class="nc" id="L88">                System.out.println(&quot;Can't change Cross and Nought while playing!&quot;);</span>
            }
        }
        
<span class="nc bnc" id="L92" title="All 2 branches missed.">        if (line.equalsIgnoreCase(&quot;s&quot;)) {</span>
<span class="nc bnc" id="L93" title="All 2 branches missed.">            if(controller.win().equals(&quot;playing&quot;)) {</span>
                String line2;
<span class="nc" id="L95">                line2 = scanner.next();</span>
<span class="nc bnc" id="L96" title="All 2 branches missed.">                if (line2.matches(&quot;[0-9][0-9]&quot;)){</span>
<span class="nc" id="L97">                    int[] arg = readToArray(line2);</span>
<span class="nc" id="L98">                    controller.setValue(arg[0], arg[1]);</span>
                } 
<span class="nc" id="L100">            } else {</span>
<span class="nc" id="L101">                System.out.println(&quot;Game is over, press 'n' to restart&quot;);</span>
            }
<span class="nc" id="L103">            checkGame();</span>
        }
        
<span class="nc bnc" id="L106" title="All 2 branches missed.">        if (line.equalsIgnoreCase(&quot;p&quot;)) {</span>
<span class="nc" id="L107">            printStatistic();</span>
        }
<span class="nc bnc" id="L109" title="All 2 branches missed.">        if (line.equalsIgnoreCase(&quot;q&quot;)) { </span>
<span class="nc" id="L110">            continu = false;</span>
        }
<span class="nc" id="L112">        return continu;</span>
    }
    private int[] readToArray(String line) {
<span class="nc" id="L115">		Pattern p = Pattern.compile(&quot;[0-9]&quot;);</span>
<span class="nc" id="L116">		Matcher m = p.matcher(line);</span>
<span class="nc" id="L117">		int[] arg = new int[line.length()];</span>
<span class="nc bnc" id="L118" title="All 2 branches missed.">		for (int i = 0; i &lt; arg.length; i++) {</span>
<span class="nc" id="L119">			m.find();</span>
<span class="nc" id="L120">			arg[i] = Integer.parseInt(m.group());</span>
		}
<span class="nc" id="L122">		return arg;</span>
	}
    
    private void printHelp() {
<span class="nc" id="L126">        System.out.print(&quot;\n-----MENU-----\n&quot;</span>
                + &quot;h\t-\tHelp\n&quot;
                + &quot;n\t-\tNew Game\n&quot;
                + &quot;m\t-\tGame Mode\n&quot;
                + &quot;c\t-\tChange Player1 to o, Player2 to x\n&quot;
                + &quot;s\t-\tSet Cell((x,y) like: 10\n&quot;
                + &quot;p\t-\tprint Statistics\n&quot;
                + &quot;q\t-\tquit\n&quot;);
<span class="nc" id="L134">    }</span>
    
    private void printStatus() {
<span class="nc bnc" id="L137" title="All 2 branches missed.">        if(controller.getCurrentState() instanceof StateCrossPlaying) {</span>
<span class="nc bnc" id="L138" title="All 2 branches missed.">            if(controller.getPlayer1().getCharacter().equals(Enum.CROSS)) {</span>
<span class="nc" id="L139">                System.out.println(controller.getPlayer1().getName() + turn);</span>
            } else {
<span class="nc" id="L141">                System.out.println(controller.getPlayer2().getName() + turn);</span>
            }
        }
<span class="nc bnc" id="L144" title="All 2 branches missed.">        if(controller.getCurrentState() instanceof StateNoughtPlaying) {</span>
<span class="nc bnc" id="L145" title="All 2 branches missed.">            if(controller.getPlayer2().getCharacter().equals(Enum.NOUGHT)) {</span>
<span class="nc" id="L146">                System.out.println(controller.getPlayer2().getName() + turn);</span>
            } else {
<span class="nc" id="L148">                System.out.println(controller.getPlayer1().getName() + turn);</span>
            }
        }
<span class="nc" id="L151">    }</span>
    
    private void printStatistic() {
<span class="nc" id="L154">        System.out.println(controller.getPlayer1().getName() + &quot;(&quot; </span>
<span class="nc" id="L155">                + controller.getPlayer1().getCharacter() + &quot;)\t&quot; </span>
<span class="nc" id="L156">                + controller.getPlayer2().getName() + &quot;(&quot; </span>
<span class="nc" id="L157">                + controller.getPlayer2().getCharacter() + &quot;)&quot;);</span>
<span class="nc" id="L158">        System.out.println(&quot;Wins: &quot; + controller.getPlayer1().getWinCount()</span>
<span class="nc" id="L159">                + &quot;\t\tWins: &quot; + controller.getPlayer2().getWinCount());</span>
<span class="nc" id="L160">        System.out.println(&quot;Lost: &quot; + controller.getPlayer1().getLooseCount()</span>
<span class="nc" id="L161">                + &quot;\t\tLost: &quot; + controller.getPlayer2().getLooseCount());</span>
<span class="nc" id="L162">        System.out.println(&quot;Draw: &quot; + controller.getPlayer1().getDrawCount()</span>
<span class="nc" id="L163">                + &quot;\t\tDraw: &quot; + controller.getPlayer2().getDrawCount());</span>
<span class="nc" id="L164">    }</span>

    private void checkGame() {
<span class="nc" id="L167">        String win = controller.win();</span>
<span class="nc bnc" id="L168" title="All 2 branches missed.">        if(win.equals(controller.getPlayer1().getName())) {</span>
<span class="nc" id="L169">            System.out.println(controller.getPlayer1().getCharacter() + &quot; wins!&quot;</span>
                    + &quot; Press 'n' to restart&quot;);
<span class="nc bnc" id="L171" title="All 2 branches missed.">        } else if(win.equals(controller.getPlayer2().getName())) {</span>
<span class="nc" id="L172">            System.out.println(controller.getPlayer2().getCharacter() + &quot; wins!&quot;</span>
                    + &quot; Press 'n' to restart&quot;);
<span class="nc bnc" id="L174" title="All 2 branches missed.">        } else if(win.equals(&quot;draw&quot;)) {</span>
<span class="nc" id="L175">            System.out.println(&quot;Game is Draw! Press 'n' to restart&quot;);</span>
<span class="nc bnc" id="L176" title="All 2 branches missed.">        } else if(win.equals(&quot;playing&quot;)) {</span>
<span class="nc" id="L177">            System.out.println(&quot;Game is not finished!&quot;);</span>
        }
<span class="nc" id="L179">    }</span>
    
    private void player() {
<span class="nc" id="L182">        int j = 0;</span>
<span class="nc bnc" id="L183" title="All 2 branches missed.">        if(mode.equals(&quot;p&quot;)) {</span>
<span class="nc" id="L184">            j = 2;</span>
        } else { 
<span class="nc" id="L186">            j = 1;</span>
        }   
<span class="nc" id="L188">        String playername[] = new String[j];</span>
<span class="nc bnc" id="L189" title="All 2 branches missed.">        for (int i = 0; i &lt; j; i++) {</span>
<span class="nc" id="L190">            System.out.println(&quot;Type in Playername&quot; + (i + 1) + &quot;: &quot;);</span>
<span class="nc" id="L191">            playername[i] = scanner.next();</span>
        }
<span class="nc" id="L193">        controller.setPlayer1(playername[0], Enum.CROSS);</span>
<span class="nc bnc" id="L194" title="All 2 branches missed.">        if(j == 2) {</span>
<span class="nc" id="L195">            controller.setPlayer2(playername[1], Enum.NOUGHT);</span>
<span class="nc" id="L196">            System.out.println(controller.getPlayer1().getName() + is + controller.getPlayer1().getCharacter()</span>
<span class="nc" id="L197">                + &quot;, &quot; + controller.getPlayer2().getName() + is + controller.getPlayer2().getCharacter());</span>
        } else {
<span class="nc" id="L199">            controller.setPlayer2(&quot;Artificial Intelligence&quot;, Enum.NOUGHT);</span>
<span class="nc" id="L200">            System.out.println(controller.getPlayer1().getName() + is + controller.getPlayer1().getCharacter()</span>
<span class="nc" id="L201">                + &quot;, &quot; + controller.getPlayer2().getName() + is + controller.getPlayer2().getCharacter());</span>
        }
<span class="nc" id="L203">    }</span>
    
    private void modeChange() {
        while(true) {
<span class="nc" id="L207">            System.out.println(&quot;Choose your game Mode:\n&quot;</span>
                + &quot;a\t-\tvs Artificial Intelligence\n&quot;
                + &quot;p\t-\tvs Player&quot;);
<span class="nc" id="L210">            mode = scanner.next();</span>
<span class="nc bnc" id="L211" title="All 2 branches missed.">            if(mode.equalsIgnoreCase(&quot;a&quot;)) {</span>
<span class="nc" id="L212">                this.mode = mode;</span>
<span class="nc" id="L213">                break;</span>
            }
<span class="nc bnc" id="L215" title="All 2 branches missed.">            if(mode.equalsIgnoreCase(&quot;p&quot;)) {</span>
<span class="nc" id="L216">                this.mode = mode;            </span>
<span class="nc" id="L217">                break;</span>
            }
        }
<span class="nc" id="L220">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.4.201502262128</span></div></body></html>